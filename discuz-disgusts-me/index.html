<!DOCTYPE HTML>
<html lang="zh-hans">
<head>
  <meta charset="utf-8">
  
  <title>Discuz让我感到国产程序深深的恶意 | undefined | everything starts &amp; ends</title>

  
  <meta name="author" content="jasonslyvia">
  

  
  <meta name="description" content="月初的时候接到一个 Discuz 二次开发的活儿，虽然我没有开发过 Discuz，但作为国内两大论坛程序之一，想必不会差到哪儿去。但是做了近两周的开发后，我不得不说 Discuz 让我感到了国内开源社区深深的恶意。在这里不吐不快，记录下来供后人参考。
注：以下内容均为一家之辞，如有不当之处，欢迎指正">
  

  
  
  <meta name="keywords" content="开源">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/manifest.json">
  <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  <meta property="og:title" content="Discuz让我感到国产程序深深的恶意"/>

  <meta property="og:site_name" content="undefined"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="undefined" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">undefined</a>
    </h1>
    <p class="site-description">everything starts &amp; ends</p>
  </div>
  <nav class="site-navigation">
    <ul class=" dim">
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
        <li><a href="/subscribe">订阅</a></li>
      
    </ul>
  </nav>
</header>


    <main class="site-main posts-loop">
    <article class=" single-post  single-page">

  
    
    <h3 class="article-title"><span>Discuz让我感到国产程序深深的恶意</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/discuz-disgusts-me/" rel="bookmark">
        <time class="entry-date published" datetime="2014-02-26T18:36:29.000Z">
          2014-02-26
        </time>
      </a>
      <a href="https://github.com/jasonslyvia/undefinedblog/tree/master/source/_posts/Discuz让我感到国产程序深深的恶意.md" target="_blank" style="margin-left: 10px" rel="nofollow">查看源码</a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>月初的时候接到一个 Discuz 二次开发的活儿，虽然我没有开发过 Discuz，但作为国内两大论坛程序之一，想必不会差到哪儿去。但是做了近两周的开发后，我不得不说 Discuz 让我感到了国内开源社区深深的恶意。在这里不吐不快，记录下来供后人参考。</p>
<p>注：以下内容均为一家之辞，如有不当之处，欢迎指正。</p>
<p>首先应该说明，<strong>Discuz 并不是严格意义上的开源程序。</strong>但是作为国内人气如此之高的 PHP 论坛程序，作为被腾讯这样的互联网巨头收购的公司，Discuz 对二次开发以及整个二次开发社区实在是太不友好了！下面吐槽开始：</p>
<p></p><h2>文档稀缺、不规范，入门困难</h2><br>当你满心欢喜的下载了 Discuz 在本地部署成功后，第一件事当然是看官方文档了解整个程序的大致结构，包括程序入口、路由规则、核心文件是哪些等等，但是你在 Discuz 官网上能看到的只有 2011 年的零碎文章（<a href="http://www.discuz.net/portal.php?mod=list&amp;catid=12），这还是针对" target="_blank" rel="noopener">http://www.discuz.net/portal.php?mod=list&amp;catid=12），这还是针对</a> Discuz X 2.5 的。我不清楚该版本和最新的 Discuz X 3.1 有多少差距，但是对于程序员来说，没有详细的、完整的、正确的文档，二次开发简直就是灾难。<p></p>
<p>更不要说 Discuz 那多如牛毛的数据表，要想摸清楚哪张表是干什么的着实需要一番功夫，所有你可以参考的就是 Discuz 官方提供的『数据字典』。</p>
<p>最后再说一句，这么大一个论坛程序，竟然没有一本完整的教程书。不需要你写的像国外那些技术书一样好，随便弄个《21天学会Discuz》之类的水平也行啊。关键是木有！</p>
<p></p><h2>基本所有模板、插件均收费，且质量参差</h2><br>好吧，勉强看看这些东拼西凑、毫无逻辑可言的『教程』，然后开始着手二次开发。一般 Discuz 二次开发，都需要自己定义一套新的样式，这在 Discuz 里叫做『模板』开发，放在 /template 下。<p></p>
<p>由于需要加快开发速度，我们选择先购买一套现有的模板进行二次开发。正如小标题所说，基本上 Discuz 上的所有模板都是收费的，虽然每一款收费模板均有对应的免费版，但是免费版根本看不出任何样式（我们购买的这款模板，免费版总共只有一个 header 的样式）。</p>
<p>在购买了这款模板后，灾难才真正开始。由于 Discuz 会自动合并所有的模板 CSS 文件（具体有一个特殊的机制，在 CSS 文件中根据特定的标识分块加载），我没办法看到这款模板的具体 CSS。而正式安装获得源码后，我傻眼了……满篇的 &lt;div class=”clear”&gt;&lt;/div&gt; 啊有木有，不管有没有 float 都要给你加一个 clear 啊。让我这个前端工程师情何以堪！</p>
<p>除此之外整个 HTML 代码结构也是千奇百怪，没有缩进，没有注释，什么都没有……</p>
<p>到现在为止，我使用的模板已经被我改掉了 60 % 以上，这款模板买来就是为了帮我更快的熟悉 Discuz（还好是雇主掏钱）。</p>
<p></p><h2>社区分享精神差</h2><br>这才是最让我诟病的，你在搜索引擎使用『Discuz + 你的问题』搜索出来的结果，大部分是像这样的：<p></p>
<blockquote>
<p>楼主：我遇到了某某问题，blahblahblah</p>
<p>楼主：顶顶顶，求大神</p>
<p>楼主：怎么没有人啊</p>
<p>路人甲：不知道，帮顶</p>
<p>路人乙：这个问题你可以通过买模板解决（附上一个付费模板的地址）</p>
<p>楼主：再次狂顶！</p>
<p>……若干天后</p>
<p>楼主：已解决，关帖</p>
</blockquote>
<p>就这样，后人再搜索到同样的问题后，只看到前人这样的『恶意』，着实让人心寒。当然我这么说有点道德绑架，也有点玻璃心，我没有权利要求别人分享自己的知识。但是我认为，一个程序是否强大、生命力是否顽强，就是看社区中每一个开发者的素质和能力。如果大家都没有分享精神，那么这个程序是很难继续发展的。</p>
<p>在这里，不得不提到我熟悉的 Wordpress，整个社区的氛围实在是太好了，再配合 StackOverflow，基本可以做到没有你找不到的答案。</p>
<p></p><h2>小礼物</h2><br>以上吐槽完毕，为了给 Discuz 社区奉献一点爱心，我分享一个一键清除 Discuz 缓存的代码，经常调试模板的同学应该会用到。将以下脚本放到网站根目录，通过访问 <a href="http://你的域名/clear_cache?type=1,2,3" target="_blank" rel="noopener">http://你的域名/clear_cache?type=1,2,3</a> 一键清除 Discuz 缓存。其中 type 可以取 1、2或3，多个值用英文逗号（,）分割，分别是：<p></p>
<p><ul><br>    <li>1： CSS缓存</li><br>    <li>2： 模板缓存</li><br>    <li>3： DIY模块缓存</li><br></ul><br>使用该脚本会验证登录的 cookies，所以需要在登录 Discuz 后台后使用。</p>
<p><a href="https://gist.github.com/jasonslyvia/9227297" target="_blank">Gist</a></p>
<p><pre class="lang:php decode:true">&lt;?php</pre></p>
<p>require ‘./source/class/class_core.php’;<br>require ‘./source/function/function_misc.php’;<br>require ‘./source/function/function_forum.php’;<br>require ‘./source/function/function_admincp.php’;<br>require ‘./source/function/function_cache.php’;</p>
<p>$discuz = C::app();<br>$discuz-&gt;init();</p>
<p>$admincp = new discuz_admincp();<br>$admincp-&gt;core  = &amp; $discuz;<br>$admincp-&gt;init();</p>
<p>$type = explode(‘,’, $_GET[‘type’]);</p>
<pre><code>//更新数据缓存
if(in_array(1, $type)) {
    updatecache();
    require_once libfile(&apos;function/group&apos;);
    $groupindex[&apos;randgroupdata&apos;] = $randgroupdata = grouplist(&apos;lastupdate&apos;, array(&apos;ff.membernum&apos;, &apos;ff.icon&apos;), 80);
    $groupindex[&apos;topgrouplist&apos;] = $topgrouplist = grouplist(&apos;activity&apos;, array(&apos;f.commoncredits&apos;, &apos;ff.membernum&apos;, &apos;ff.icon&apos;), 10);
    $groupindex[&apos;updateline&apos;] = TIMESTAMP;
    $groupdata = C::t(&apos;forum_forum&apos;)-&amp;gt;fetch_group_counter();
    $groupindex[&apos;todayposts&apos;] = $groupdata[&apos;todayposts&apos;];
    $groupindex[&apos;groupnum&apos;] = $groupdata[&apos;groupnum&apos;];
    savecache(&apos;groupindex&apos;, $groupindex);
    C::t(&apos;forum_groupfield&apos;)-&amp;gt;truncate();
    savecache(&apos;forum_guide&apos;, &apos;&apos;);
    if($_G[&apos;setting&apos;][&apos;grid&apos;][&apos;showgrid&apos;]) {
        savecache(&apos;grids&apos;, array());
    }

    echo &quot;数据缓存更新成功&amp;lt;br /&amp;gt;&quot;;
}
//模板缓存
if(in_array(2, $type)) {
    cleartemplatecache();
    echo &quot;模板缓存更新成功&amp;lt;br /&amp;gt;&quot;;
}
//模块缓存
if(in_array(3, $type)) {
    include_once libfile(&apos;function/block&apos;);
    blockclass_cache();

    echo &quot;DIY模块缓存更新成功&amp;lt;br /&amp;gt;&quot;;
}

exit();
</code></pre><p>?&gt;<br>明日将抵杭州，新的开始。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/开源/">开源</a>
    </span>
    

    </div>

    
  </div>
</article>

  
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'undefinedblog';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Powered by <a href="https://hexo.io/" target="_blank" rel="nofollow">Hexo</a> and
    Theme adapted from <a href="https://github.com/CodeDaraW/Hacker" target="_blank" rel="nofollow">Hacker</a>
    <br />
    
    &copy; 2017 jasonslyvia
    
  </p>
</footer>

    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-50332938-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
</body>
</html>
